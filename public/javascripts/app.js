

//Collect Data


var positionData = Q.promise(function(resolve,reject){
  d3.csv( window.ctx.csvPath )
      .row(function(d) {


        d.circle1_r = +d.circle1_r;
        d.circle1_x = +d.circle1_x;
        d.circle1_y = +d.circle1_y;
        d.circle2_r = +d.circle2_r;
        d.circle2_x = +d.circle2_x;
        d.circle2_y = +d.circle2_y;

        d.dis = parseFloat(d.dis);
        d.gameId = +d.gameId;
        d.gsisPlayId = +d.gsisPlayId;
        d.jerseyNumber = +d.jerseyNumber;

        var bin = parseFloat(d.millisecs_since_epoch)*100;
        //bin - bin %10
        d.millisecs_since_epoch = bin - (bin % 10);
        d.nflId = +d.nflId;
        d.ngsPlayId = +d.ngsPlayId;
        d.s = parseFloat(d.s);
        d.time = new Date(d.time);
        d.weight = +d.weight;
        d.x = +d.x;
        d.y = +d.y;

        return d;
      })
      .get(function(error, rows) {

        var playerPosition = d3.nest()
        //.key(function(d){ return d.gameId; }) //Game
        //.key(function(d){ return d.ngsPlayId; }) //

          .key(function(d){ return d.nflId; })
          .key(function(d){ return d.millisecs_since_epoch })
          .entries(rows);

        var playerHeat = d3.nest()
          .key(function(d){ return d.team; })
          .key(function(d){ return d.millisecs_since_epoch })
          .entries(rows);

          resolve([playerPosition,playerHeat])
      });
})

var coverageData = Q.promise(function(resolve,reject){

  d3.csv( window.ctx.csvPathCoverage )
      .row(function(d) {

        d.away_cover_px= +d.away_cover_px;
        d.coverage= parseFloat(d.coverage);
        d.coverage_smooth = (d.coverage_smooth === "NA") ? 0: parseFloat(d.coverage_smooth)

        var bin = parseFloat(d.millisecs_since_epoch)*100;
        //bin - bin %10
        d.millisecs_since_epoch = bin - (bin % 10);

        return d;
      })
      .get(function(error, rows) {

        var playerPosition = d3.nest()
        //.key(function(d){ return d.gameId; }) //Game
        //.key(function(d){ return d.ngsPlayId; }) //

          .key(function(d){ return d.nflId; })
          .key(function(d){ return d.millisecs_since_epoch })
          .entries(rows);

          resolve(playerPosition);
      });

    });



Q.all([ positionData,coverageData])
.then(function(payload){

    app( payload[0][0], payload[0][1], payload[1])
})


function app(data, heatmapData){



  // var data1 = JSON.parse('[{"name":"Lorem","dates":["2016-02-14T13:23:10.206Z","2016-02-07T15:12:41.097Z","2015-10-09T03:58:36.674Z","2016-01-20T22:00:24.107Z","2015-11-23T02:03:38.964Z","2016-01-19T22:29:56.605Z","2015-11-02T16:22:21.148Z","2016-02-07T23:24:19.091Z","2015-11-13T12:10:03.495Z","2015-10-26T16:01:02.387Z","2015-09-22T04:22:10.484Z","2015-11-23T06:00:14.511Z","2015-10-14T17:37:16.543Z","2016-01-04T13:04:57.210Z","2015-10-22T21:04:05.597Z","2015-12-06T16:37:02.240Z","2016-02-20T08:04:55.298Z","2016-01-13T01:22:26.653Z","2015-09-11T04:28:44.250Z","2016-02-21T02:48:41.651Z","2016-02-13T03:17:07.258Z","2015-12-13T17:33:26.084Z","2015-09-09T08:31:54.233Z","2015-12-09T02:40:35.564Z","2015-10-19T06:04:20.581Z","2015-10-28T22:28:44.457Z","2015-11-17T01:06:54.609Z","2016-01-31T09:09:48.493Z","2016-01-23T14:56:23.020Z","2015-11-21T14:51:11.698Z","2016-01-30T08:16:44.015Z","2016-02-19T18:00:45.076Z","2015-09-05T00:09:04.947Z","2016-01-19T10:48:09.119Z","2015-12-05T17:33:20.672Z","2016-01-04T19:52:36.488Z","2015-12-24T10:52:07.724Z","2015-09-18T03:40:19.169Z","2016-02-07T22:05:42.860Z","2016-02-17T03:13:05.899Z","2016-02-19T13:01:51.133Z","2015-10-14T21:13:20.854Z","2016-01-09T03:40:35.178Z","2015-08-30T01:34:23.200Z","2016-01-06T17:39:36.239Z","2016-01-09T18:44:30.687Z","2016-02-06T02:00:49.634Z","2016-02-20T08:38:18.810Z","2015-09-14T07:17:57.983Z","2015-10-14T15:45:33.153Z","2016-02-13T21:46:50.823Z","2016-01-14T20:39:29.904Z","2016-01-04T01:28:50.278Z","2016-02-04T18:56:10.319Z"]},{"name":"Ipsum","dates":["2015-11-13T05:55:45.465Z","2015-10-20T20:48:54.734Z","2015-09-03T21:42:44.284Z","2015-11-19T23:57:24.526Z","2015-12-02T04:20:56.048Z","2016-02-21T08:20:05.496Z","2015-08-28T11:56:50.310Z","2016-01-02T04:48:20.364Z","2015-11-12T19:35:32.820Z","2015-09-24T10:19:52.448Z","2015-12-30T19:16:56.883Z","2015-10-31T21:11:47.787Z","2015-12-11T22:53:00.441Z","2016-02-20T01:09:39.251Z","2016-02-03T19:30:38.307Z","2015-11-29T22:48:34.056Z","2015-12-02T07:19:03.644Z","2015-11-04T12:35:26.201Z","2015-11-21T07:00:42.148Z","2015-09-22T02:02:39.841Z","2016-01-17T11:58:35.192Z","2016-02-21T08:22:36.712Z","2015-09-28T19:27:40.177Z","2015-12-15T19:19:29.574Z","2016-01-14T23:24:33.974Z","2015-10-05T14:14:30.270Z","2016-02-21T12:16:40.553Z","2015-11-18T02:19:48.225Z","2015-09-15T23:05:23.911Z","2015-10-25T12:30:47.868Z","2015-11-01T01:27:53.019Z","2015-11-08T18:21:51.426Z","2015-10-10T02:46:59.414Z","2015-09-19T09:36:47.722Z","2016-01-31T14:55:09.868Z","2016-01-26T18:06:43.601Z","2015-10-05T01:14:08.780Z","2016-01-01T13:40:19.649Z","2015-10-16T17:27:06.679Z","2015-10-28T13:35:50.786Z","2015-11-03T09:55:51.685Z","2015-10-03T22:07:20.017Z","2015-12-02T11:27:03.589Z","2015-12-18T15:36:15.045Z","2016-02-03T03:09:05.266Z","2015-10-08T12:31:38.653Z","2015-10-25T05:21:41.758Z","2015-11-28T01:30:12.179Z","2015-11-15T21:30:01.076Z","2015-12-15T05:36:27.491Z","2015-11-30T07:00:45.653Z","2016-01-15T02:51:03.958Z","2015-12-07T18:59:24.545Z","2015-09-06T07:00:27.353Z","2016-01-02T03:10:40.228Z","2015-12-19T14:15:33.841Z","2015-11-13T23:38:44.486Z","2015-10-08T00:13:19.111Z","2016-02-16T15:15:55.494Z","2015-09-14T00:29:02.751Z"]},{"name":"Dolor","dates":["2015-10-05T02:14:54.059Z","2016-02-10T18:12:05.367Z","2015-10-28T13:08:49.705Z","2015-11-24T04:54:23.134Z","2016-02-20T08:42:10.284Z","2015-11-01T01:40:42.898Z","2015-10-22T04:15:35.885Z","2015-11-09T16:50:33.407Z","2015-09-04T00:21:34.072Z","2015-11-26T06:57:26.723Z","2016-02-02T15:41:24.283Z","2015-11-07T02:50:33.955Z","2015-10-17T03:36:29.989Z","2016-01-06T02:18:09.247Z","2015-12-23T06:23:05.734Z","2015-10-09T07:03:29.318Z","2015-12-26T15:23:52.312Z","2015-10-30T18:40:10.733Z","2016-02-02T20:19:26.999Z","2016-01-10T01:06:29.607Z","2015-11-18T02:48:09.124Z","2015-09-09T11:53:40.770Z","2015-12-13T19:39:33.046Z","2016-01-26T01:40:09.450Z","2015-12-13T17:41:52.674Z","2015-12-24T19:21:52.820Z","2015-12-09T06:26:13.062Z","2015-08-27T11:15:07.909Z","2015-12-19T15:11:12.307Z","2015-10-20T07:06:07.162Z","2016-01-19T04:37:49.817Z","2016-01-18T10:03:46.616Z","2015-09-25T15:50:02.945Z","2016-01-26T08:06:32.491Z","2015-11-21T04:41:00.910Z","2015-11-13T11:55:57.236Z","2015-10-30T05:47:06.328Z","2015-09-15T00:38:07.645Z","2015-12-17T11:25:43.079Z","2015-10-19T03:14:33.386Z","2015-11-30T20:10:03.118Z","2015-12-28T09:28:26.129Z","2015-09-12T01:14:46.064Z","2015-12-24T01:45:49.206Z","2015-09-17T10:56:37.557Z","2015-09-14T21:28:02.877Z","2015-11-04T21:26:44.615Z","2015-11-12T15:47:30.942Z","2015-10-17T03:06:04.934Z","2015-12-14T19:59:44.557Z","2015-11-10T15:00:58.878Z","2015-12-12T23:31:28.779Z","2016-01-22T03:43:43.866Z","2015-11-30T01:42:26.233Z","2015-12-17T17:47:09.167Z","2016-01-22T01:26:30.701Z","2016-02-18T12:43:58.618Z","2016-01-27T06:26:59.473Z","2016-01-04T13:43:42.996Z","2015-08-30T16:55:15.257Z","2016-01-17T15:34:34.839Z","2015-08-30T11:01:59.320Z","2015-10-07T07:38:51.438Z","2016-01-17T02:50:37.257Z","2016-01-31T17:00:41.308Z","2015-12-12T00:40:37.039Z","2015-11-15T19:18:18.550Z","2015-11-16T07:35:49.172Z","2016-01-09T22:26:30.727Z","2015-10-26T16:14:38.567Z","2015-09-12T17:37:07.648Z","2015-08-27T03:16:03.032Z","2015-10-23T02:17:12.896Z","2015-10-27T07:04:16.877Z","2016-02-18T19:27:54.833Z","2016-02-14T11:28:09.530Z","2016-02-09T15:55:55.325Z","2015-12-10T06:13:56.766Z","2015-10-24T00:22:01.924Z","2015-11-23T18:11:39.779Z","2015-09-22T11:21:55.219Z","2015-12-30T04:35:01.008Z","2015-08-29T04:33:33.764Z","2015-09-01T05:11:46.543Z","2015-09-30T07:56:06.633Z","2016-01-24T02:50:07.069Z","2015-09-18T05:36:37.913Z","2015-08-28T20:13:23.382Z","2015-10-09T10:49:57.322Z","2015-11-10T15:10:22.662Z","2015-10-11T21:35:52.448Z","2016-01-21T17:19:27.188Z","2015-09-14T10:53:59.042Z","2015-10-17T18:29:35.064Z","2016-01-29T05:45:03.825Z","2015-09-20T21:23:45.984Z","2015-10-06T21:17:53.964Z","2015-12-13T01:08:11.323Z","2015-12-03T01:11:37.749Z","2015-08-26T11:23:42.829Z","2015-09-08T13:20:16.605Z","2015-11-17T01:10:49.195Z","2015-09-21T10:08:02.374Z","2015-11-04T05:32:14.172Z","2015-09-02T08:28:14.914Z","2015-08-30T11:10:56.463Z","2016-01-26T02:36:45.511Z","2015-12-01T09:01:34.282Z","2015-10-28T10:24:57.753Z","2015-09-15T05:02:40.482Z","2015-08-30T16:30:05.054Z","2015-09-04T06:23:49.977Z","2016-01-01T16:09:29.613Z","2015-12-22T20:39:43.586Z","2015-12-22T17:57:44.273Z","2015-11-05T21:11:47.522Z","2015-12-04T23:43:39.810Z","2015-10-03T04:15:34.585Z","2015-08-26T19:36:16.275Z","2015-10-25T17:28:16.438Z","2015-09-02T23:08:52.840Z","2015-10-17T15:01:40.614Z","2015-11-07T05:35:12.410Z","2016-01-07T16:29:36.314Z","2015-09-05T00:46:38.531Z","2015-11-11T10:21:02.364Z","2015-10-19T04:41:03.452Z","2015-12-06T13:45:18.800Z","2015-09-04T08:32:07.258Z","2015-12-18T01:56:31.654Z","2016-01-31T04:07:30.812Z","2016-01-17T14:58:01.752Z","2015-11-19T06:46:04.794Z","2016-01-18T19:27:53.378Z","2015-11-09T09:17:26.718Z","2015-12-02T11:58:24.030Z","2016-01-21T11:15:42.033Z","2016-01-18T08:22:53.866Z","2015-09-23T12:05:11.223Z","2016-02-01T10:22:49.445Z","2015-09-10T22:06:59.191Z","2015-11-13T11:50:05.428Z","2016-02-11T22:07:01.759Z","2016-01-27T02:19:53.894Z","2015-11-28T16:46:50.745Z","2015-10-04T10:10:42.601Z","2016-01-28T08:57:27.750Z","2015-10-29T13:46:34.845Z","2015-10-19T22:45:55.078Z","2015-09-01T07:49:01.994Z","2015-09-20T15:28:27.017Z","2015-11-27T06:51:45.885Z","2015-12-20T13:05:48.593Z","2016-01-08T07:06:32.991Z","2015-09-28T07:43:59.792Z","2015-11-28T20:24:10.626Z","2015-10-25T19:05:38.270Z","2016-01-21T12:37:00.930Z","2015-11-16T12:49:46.079Z","2015-12-11T10:33:57.013Z","2015-12-05T22:49:15.218Z","2016-01-01T22:56:29.788Z","2016-02-16T01:25:22.864Z","2015-10-23T12:31:00.613Z","2015-09-03T11:07:13.550Z","2015-10-11T05:57:04.565Z"]},{"name":"Sit","dates":["2015-09-18T20:50:31.232Z","2015-12-08T21:19:56.366Z","2016-02-21T11:44:31.747Z","2015-10-05T20:35:57.409Z","2015-11-30T05:11:32.961Z","2015-09-28T07:31:35.105Z","2015-12-25T17:25:35.534Z","2015-12-23T22:13:02.094Z","2015-10-23T13:20:44.375Z","2015-11-25T03:38:23.244Z","2016-01-28T12:01:10.961Z","2015-09-17T22:55:48.595Z","2015-09-18T20:52:32.285Z","2016-01-01T19:20:42.941Z","2016-02-14T06:15:19.253Z","2015-09-23T11:57:06.692Z","2015-10-20T09:56:36.194Z","2015-12-26T13:39:20.050Z","2015-09-11T12:49:04.162Z","2016-01-17T21:16:28.609Z","2016-01-18T01:54:36.593Z","2015-09-23T06:46:26.545Z","2015-12-30T17:42:38.522Z","2016-01-17T06:09:16.267Z","2015-12-29T14:20:15.741Z","2015-12-05T16:03:51.610Z","2015-11-25T20:55:04.918Z","2016-02-17T15:22:42.856Z","2016-01-05T08:13:12.685Z","2015-09-29T23:59:49.421Z","2015-12-31T14:26:09.707Z","2015-10-19T05:30:12.032Z","2016-02-18T19:35:28.270Z","2015-11-23T07:13:04.837Z","2015-10-28T16:57:11.635Z","2015-11-06T22:26:50.849Z","2016-02-12T21:51:36.553Z","2016-02-14T04:30:31.095Z","2016-01-28T09:33:32.228Z","2016-01-28T20:04:50.204Z","2016-01-15T04:15:17.484Z","2015-11-14T02:40:13.402Z","2016-01-28T21:39:52.831Z","2015-11-02T12:51:42.881Z","2015-10-16T10:55:19.328Z","2015-09-11T20:44:11.369Z","2016-01-25T14:05:37.047Z","2015-10-16T19:42:05.535Z","2016-01-06T21:12:42.238Z","2015-12-09T11:25:38.072Z","2016-01-23T01:58:59.635Z","2015-11-08T14:12:43.001Z","2016-02-05T09:08:45.571Z","2015-12-12T16:01:04.756Z","2015-11-23T01:45:22.361Z","2015-12-03T11:39:04.282Z","2015-12-20T10:02:24.174Z","2015-08-26T11:18:43.873Z","2016-01-03T05:49:42.746Z","2016-01-30T14:53:44.164Z","2015-12-11T18:06:32.569Z","2015-09-02T23:42:33.742Z","2015-12-18T02:40:06.187Z","2016-02-04T12:36:11.576Z","2016-01-28T05:12:49.976Z","2016-01-03T23:46:47.599Z","2016-01-18T02:39:52.753Z","2015-10-18T22:47:06.141Z","2016-02-12T12:06:13.804Z","2015-10-09T01:34:00.740Z","2016-01-08T13:19:04.072Z","2015-09-14T07:03:51.307Z","2015-10-15T17:56:08.319Z","2015-10-02T21:09:48.694Z","2015-11-03T16:34:52.395Z","2016-02-15T11:07:50.851Z","2015-12-24T22:44:31.416Z","2015-12-26T04:11:42.786Z","2015-12-13T17:56:28.510Z","2015-12-28T04:48:50.205Z","2015-12-21T00:01:32.541Z","2015-10-30T16:42:25.049Z","2015-12-30T01:10:37.991Z","2016-01-17T19:26:46.159Z","2015-09-25T01:17:55.027Z","2015-09-28T19:37:19.168Z","2015-10-16T16:11:34.260Z","2015-09-10T04:08:21.352Z","2015-11-07T23:30:10.949Z","2015-11-28T01:27:35.336Z","2015-10-13T12:56:59.671Z","2015-09-06T06:55:18.226Z","2015-10-29T09:51:43.847Z","2016-02-14T03:32:05.082Z","2016-01-19T14:47:13.205Z","2015-09-27T19:56:44.818Z","2015-10-24T22:01:55.508Z","2016-02-10T02:44:39.424Z","2015-12-31T15:59:56.156Z","2016-01-22T19:57:08.360Z","2015-10-08T08:19:41.027Z","2016-01-19T08:22:32.562Z","2015-11-12T15:09:35.734Z","2015-12-21T16:18:31.350Z"]},{"name":"Amet","dates":["2015-10-04T03:08:10.645Z","2015-11-18T21:24:40.231Z","2016-01-08T18:35:34.664Z","2015-09-14T19:35:16.894Z","2015-12-03T18:34:19.272Z","2015-11-29T15:02:22.986Z","2015-09-17T12:49:21.541Z","2016-02-12T16:53:30.903Z","2015-10-03T01:35:05.858Z","2016-01-22T15:22:40.463Z","2015-09-22T22:42:38.591Z","2015-09-02T21:01:07.376Z","2015-11-06T17:59:06.699Z","2015-10-24T01:58:06.636Z","2015-09-28T19:12:20.701Z","2015-12-01T18:35:58.229Z","2015-10-19T11:13:34.899Z","2016-01-29T22:14:22.412Z","2016-02-14T18:24:31.837Z","2016-02-02T10:55:51.874Z","2015-12-02T19:19:57.084Z","2015-11-28T21:07:08.157Z","2015-10-23T18:43:35.912Z","2016-02-14T14:13:23.189Z","2015-11-07T15:19:51.628Z","2015-11-07T10:48:36.522Z","2015-12-02T19:22:26.728Z","2015-12-30T15:42:23.429Z","2015-11-14T21:24:38.339Z","2015-09-09T03:08:02.855Z","2015-09-03T20:18:00.219Z","2015-12-06T04:43:54.459Z","2015-11-05T02:09:27.674Z","2015-09-12T06:47:18.715Z","2016-01-16T17:34:24.479Z","2015-09-29T03:19:06.348Z","2015-11-07T13:27:34.363Z","2015-12-11T08:17:11.332Z","2015-09-06T00:17:08.560Z","2015-11-30T11:32:26.381Z","2015-12-27T20:47:58.505Z","2015-10-01T13:33:38.944Z","2015-11-19T23:28:00.097Z","2015-11-22T04:39:46.653Z","2015-11-26T18:05:10.026Z","2015-10-25T12:20:46.231Z","2015-12-22T05:59:12.453Z","2015-11-07T23:34:56.290Z","2016-01-26T08:51:59.891Z","2015-12-20T05:22:13.866Z","2015-11-27T02:57:50.676Z","2015-11-02T18:47:58.907Z","2015-09-04T15:10:54.821Z","2015-10-31T09:26:01.755Z","2015-11-27T09:10:52.916Z","2015-10-25T23:40:59.885Z","2016-02-18T00:18:21.463Z","2015-08-26T02:44:23.549Z","2016-02-12T08:30:14.059Z","2015-10-01T13:21:49.514Z","2015-12-21T19:47:06.645Z","2016-01-23T05:25:53.586Z","2016-01-18T10:55:14.307Z"]},{"name":"Consectetur","dates":["2015-12-26T10:38:21.764Z","2015-11-22T05:42:19.812Z","2016-01-29T13:11:17.958Z","2015-09-27T22:30:02.420Z","2015-08-27T14:02:03.082Z","2015-10-11T13:27:23.440Z","2016-01-23T19:37:13.507Z","2015-08-29T18:54:17.761Z","2016-02-05T18:45:38.286Z","2016-01-04T14:46:46.172Z","2015-11-07T11:11:10.291Z","2015-09-15T22:22:31.232Z","2015-10-30T05:56:04.442Z","2016-01-06T21:45:35.297Z","2016-01-30T17:12:34.723Z","2015-10-13T04:23:51.937Z","2015-10-29T21:32:30.171Z","2015-12-31T11:49:02.860Z","2015-11-01T19:26:04.245Z","2015-12-01T17:57:15.290Z","2015-12-12T14:46:28.624Z","2015-10-19T21:07:31.947Z","2015-09-29T05:31:36.044Z","2015-12-16T19:49:25.503Z","2015-09-22T18:51:26.974Z","2016-02-15T03:45:24.891Z","2016-02-03T15:37:49.706Z","2015-10-24T01:30:55.992Z","2015-10-18T01:00:43.146Z","2015-09-06T03:11:18.588Z","2016-01-14T12:43:20.865Z","2015-12-13T02:03:14.724Z","2015-11-02T19:18:49.993Z","2015-10-02T19:27:29.938Z","2015-10-12T02:47:04.789Z","2015-11-18T00:00:31.694Z","2015-11-10T01:37:35.759Z","2016-01-01T20:39:23.869Z","2015-11-12T11:14:17.554Z","2015-09-25T01:35:09.020Z","2015-11-04T18:57:35.976Z","2015-09-07T01:02:30.987Z","2016-02-18T09:25:11.121Z","2015-08-31T06:57:37.404Z","2015-11-06T13:05:57.868Z","2016-02-09T15:15:41.364Z","2016-01-15T03:04:53.007Z","2015-12-02T04:07:14.458Z","2015-09-04T02:04:21.054Z","2015-12-23T19:47:07.359Z","2015-09-27T10:26:56.888Z","2015-12-31T17:33:22.566Z","2015-10-24T13:48:17.993Z","2015-12-09T13:02:25.769Z","2015-12-05T11:18:07.140Z","2015-12-18T15:52:17.071Z","2015-08-26T00:55:16.788Z","2015-10-29T00:45:37.923Z","2016-02-17T04:07:11.838Z","2016-01-08T04:25:09.934Z","2016-02-14T21:43:25.762Z","2016-01-02T02:06:23.154Z","2015-09-27T00:16:39.803Z","2015-10-10T11:52:52.433Z","2015-09-13T21:34:51.749Z","2015-12-29T21:57:47.693Z","2015-11-04T04:09:29.469Z","2015-10-15T00:37:41.992Z","2016-02-16T01:54:48.339Z","2015-10-31T18:48:26.448Z","2015-12-17T10:45:12.661Z","2015-11-21T00:42:31.473Z","2016-01-24T01:55:37.648Z","2015-10-29T03:57:17.964Z","2015-10-20T03:46:35.865Z","2016-02-11T19:11:18.472Z","2015-12-20T02:28:49.568Z","2015-11-12T17:24:19.794Z","2015-08-31T10:45:37.626Z","2015-10-09T01:50:31.408Z","2016-02-05T22:33:21.276Z","2015-12-07T23:02:35.238Z","2016-02-18T15:20:12.443Z","2016-01-03T07:34:45.884Z","2015-09-30T01:25:44.708Z","2015-12-28T02:57:04.606Z","2016-01-29T01:24:46.504Z","2015-08-30T18:19:42.926Z","2015-12-27T16:54:09.919Z","2016-02-10T04:06:08.492Z","2015-11-02T00:18:34.320Z","2016-02-03T02:29:29.402Z","2015-11-21T20:42:20.375Z","2015-10-20T04:56:48.896Z","2016-01-22T02:59:25.008Z","2015-11-16T17:41:59.682Z","2016-02-07T23:01:50.511Z","2016-01-31T15:05:26.199Z","2015-12-09T13:14:07.708Z","2015-10-31T08:01:16.998Z","2015-12-14T07:29:30.867Z","2015-10-08T22:44:53.679Z","2015-08-26T13:09:15.818Z","2015-11-09T11:02:11.483Z","2016-01-20T23:29:14.464Z","2015-12-23T12:50:11.568Z","2015-09-24T01:17:49.079Z","2015-08-27T06:22:46.427Z","2015-10-19T21:08:24.176Z","2015-10-06T20:05:40.380Z","2015-12-11T01:50:24.124Z","2015-09-22T19:24:48.088Z","2015-10-17T12:03:18.512Z","2016-02-19T20:56:45.551Z","2015-10-20T19:00:10.891Z","2015-11-23T10:53:21.458Z","2015-12-26T03:35:50.293Z","2015-09-16T14:02:56.465Z","2016-01-12T20:21:53.003Z","2015-09-27T19:20:52.760Z","2016-01-25T08:50:19.099Z","2015-10-31T22:00:42.245Z","2015-08-27T14:49:16.175Z","2015-12-01T18:42:10.785Z","2016-01-05T06:36:29.717Z","2015-11-19T01:52:12.284Z","2015-10-30T11:44:07.436Z","2016-02-12T19:41:47.317Z","2016-02-10T07:56:05.977Z","2015-10-31T23:54:15.192Z","2016-02-05T13:03:21.621Z","2016-02-08T21:06:32.775Z","2015-08-31T14:13:01.371Z","2015-12-27T09:57:25.679Z","2016-01-20T15:16:45.801Z","2015-11-08T23:58:30.495Z","2015-12-21T23:42:14.578Z","2015-09-29T21:56:27.544Z","2015-09-17T07:33:45.557Z","2016-01-27T14:11:15.982Z","2015-08-30T23:43:04.775Z","2015-09-26T15:10:03.011Z","2015-10-07T05:35:44.728Z","2015-10-09T01:35:56.662Z","2016-02-04T03:59:56.080Z","2016-02-14T01:02:02.575Z","2015-10-31T22:57:38.305Z","2016-02-14T16:52:02.356Z","2015-11-16T21:55:04.311Z","2015-11-29T14:12:42.589Z"]},{"name":"Adipisicing","dates":["2015-09-04T03:28:52.268Z","2015-12-01T20:11:37.714Z","2016-02-16T18:08:46.124Z","2015-09-17T01:45:38.374Z","2015-12-22T02:04:21.253Z","2015-09-10T11:38:39.075Z","2016-01-05T20:52:00.500Z","2016-02-18T02:05:08.660Z","2015-11-12T09:12:14.751Z","2015-12-25T17:19:11.090Z","2015-10-04T11:21:53.437Z","2016-01-20T23:50:09.812Z","2015-09-16T23:58:54.095Z","2015-10-04T20:23:53.699Z","2015-11-29T20:50:13.509Z","2015-10-21T06:22:12.508Z","2015-09-05T07:32:27.764Z","2015-12-20T12:08:57.682Z","2016-01-18T08:48:49.573Z","2016-02-15T23:25:30.192Z","2016-02-20T20:09:41.791Z","2015-09-30T19:09:41.407Z","2015-12-30T04:59:01.905Z","2015-12-26T14:31:54.813Z","2016-01-06T14:11:54.817Z","2015-10-23T14:19:15.294Z","2015-12-09T08:15:43.761Z","2015-12-14T22:31:13.406Z","2016-02-15T01:25:12.158Z","2015-09-22T23:11:48.184Z","2015-09-08T08:16:38.362Z","2015-10-28T16:41:21.877Z","2015-10-17T12:36:38.293Z","2015-10-21T07:01:43.419Z","2016-01-18T23:29:38.301Z","2015-10-05T13:33:57.629Z","2015-09-28T00:34:35.443Z","2015-12-24T12:48:36.723Z","2015-10-06T14:19:03.008Z","2015-11-21T07:14:49.762Z","2015-09-19T19:55:02.921Z","2016-02-03T16:10:37.691Z","2015-12-14T03:13:04.894Z","2015-11-06T18:00:20.418Z","2015-11-08T20:02:02.140Z","2015-10-02T01:59:57.682Z","2015-11-05T22:24:09.004Z","2015-12-11T00:54:19.199Z","2015-10-09T05:25:50.102Z","2016-02-01T19:49:12.363Z","2015-11-21T22:07:55.695Z","2015-10-10T17:50:35.041Z","2016-02-19T08:23:49.732Z","2016-02-08T09:30:13.025Z","2015-12-11T12:38:16.736Z","2015-10-05T04:04:15.329Z","2015-12-01T15:06:25.444Z","2016-01-04T14:43:47.629Z","2015-10-01T16:42:29.812Z","2015-12-16T17:32:22.807Z","2015-12-17T19:17:37.972Z","2015-09-15T05:50:17.661Z","2015-10-25T09:58:06.931Z","2016-01-07T02:52:02.235Z","2015-09-29T06:07:53.536Z","2015-09-22T22:24:16.874Z","2016-01-11T01:09:03.095Z","2016-01-20T10:18:36.241Z","2015-12-24T04:46:15.570Z","2015-12-24T13:46:56.206Z","2015-10-16T06:03:14.919Z","2016-01-13T10:41:54.737Z","2016-02-21T09:04:08.081Z","2015-09-07T15:57:36.779Z","2015-10-10T14:29:47.276Z","2015-08-28T00:45:13.475Z","2016-02-19T04:29:53.099Z","2015-12-22T19:53:12.852Z","2015-11-11T20:16:46.278Z","2016-01-05T06:11:20.789Z","2016-01-03T02:07:04.338Z","2015-11-05T04:29:52.972Z","2016-01-29T18:10:02.417Z","2016-02-15T06:18:26.278Z","2015-12-02T22:14:11.403Z","2015-12-21T07:43:31.058Z","2015-11-26T16:26:33.200Z","2015-11-18T07:34:57.581Z","2015-08-30T22:26:03.171Z","2016-01-18T05:04:28.384Z","2015-10-28T22:07:25.877Z","2016-02-19T03:15:00.254Z","2015-11-16T13:53:34.735Z","2015-09-02T15:29:08.255Z","2015-10-20T15:30:16.086Z","2016-02-03T08:18:05.082Z","2016-01-07T16:15:41.280Z","2015-09-11T04:33:50.734Z","2015-10-30T17:28:43.603Z","2016-02-06T22:40:56.494Z","2015-10-13T08:47:49.700Z","2016-01-05T09:42:22.567Z","2015-11-05T08:16:49.331Z","2015-12-22T15:42:18.307Z","2016-02-17T02:25:32.572Z","2015-12-26T16:03:23.476Z","2015-09-14T19:59:35.632Z","2015-10-10T16:10:10.067Z","2015-08-26T14:17:45.430Z","2015-09-25T04:04:31.107Z","2016-01-10T08:23:00.986Z","2016-01-24T04:08:24.602Z","2015-12-08T13:51:47.908Z","2016-01-22T03:11:30.225Z","2015-10-17T12:04:01.178Z","2015-09-01T11:46:17.635Z","2015-12-20T05:23:01.500Z","2015-12-06T05:39:16.706Z","2015-10-07T23:21:19.154Z","2015-10-29T14:32:28.406Z","2015-11-24T15:44:59.389Z","2015-10-09T20:06:07.909Z","2015-10-07T09:41:23.751Z","2015-10-22T23:51:13.878Z","2015-09-30T04:27:13.599Z","2015-10-19T13:35:44.774Z","2016-01-07T20:08:03.267Z","2015-11-03T14:46:19.211Z","2015-11-07T13:17:22.439Z","2016-02-02T22:09:30.591Z","2015-11-07T09:21:10.382Z","2015-11-16T09:51:34.977Z"]},{"name":"elit","dates":["2015-09-03T11:59:07.058Z","2016-01-29T10:49:34.436Z","2015-10-24T04:46:59.723Z","2016-02-11T02:02:13.300Z","2015-09-04T09:47:22.308Z","2016-01-27T16:56:10.102Z","2015-11-22T22:24:39.271Z","2015-12-10T14:04:57.688Z","2015-09-10T02:23:44.470Z","2015-09-19T09:40:32.455Z","2015-09-21T01:47:25.469Z","2015-12-06T02:03:43.699Z","2015-10-09T01:03:47.399Z","2015-12-21T16:56:05.365Z","2016-02-12T12:12:09.899Z","2015-12-21T07:35:51.154Z","2016-02-16T18:23:32.407Z","2015-09-21T22:40:01.365Z","2015-12-29T20:37:29.237Z","2016-01-16T09:34:23.538Z","2016-01-15T11:06:21.423Z","2015-09-01T20:38:43.215Z","2015-12-26T23:03:54.577Z","2015-10-29T15:51:52.160Z","2015-08-30T12:13:24.824Z","2015-10-01T10:46:19.390Z","2016-01-24T20:01:21.619Z","2016-01-29T02:37:25.214Z","2015-09-11T03:26:39.635Z","2015-12-27T13:54:28.647Z","2015-11-12T02:26:50.615Z","2015-11-17T18:23:55.492Z","2015-08-28T22:30:39.882Z","2016-01-16T09:14:22.121Z","2015-11-05T23:47:25.876Z","2015-11-05T11:03:43.393Z","2015-10-11T16:06:10.023Z","2016-01-31T11:54:35.071Z","2015-10-19T07:14:18.280Z","2015-10-04T01:10:15.978Z","2015-10-15T20:23:58.397Z"]},{"name":"Eiusmod tempor","dates":["2016-02-16T18:11:25.491Z","2015-10-21T11:57:11.291Z","2015-10-29T03:38:30.064Z","2016-02-20T16:08:21.191Z","2015-11-09T18:16:03.154Z","2015-08-28T09:05:02.413Z","2016-01-10T11:52:10.713Z","2015-11-02T03:11:39.698Z","2016-02-07T09:25:21.457Z","2015-09-09T17:46:21.026Z","2015-09-22T03:46:03.507Z","2016-02-18T20:12:34.903Z","2015-09-07T07:13:31.214Z","2016-01-16T09:22:31.870Z","2016-02-15T14:36:59.983Z","2015-10-06T01:40:02.147Z","2015-12-25T12:22:42.328Z","2015-12-11T12:32:23.078Z","2016-01-18T22:06:35.898Z","2015-11-16T08:10:44.645Z","2015-09-30T12:03:03.232Z","2015-08-28T08:31:43.294Z","2015-11-11T20:54:52.023Z","2015-11-01T19:16:27.708Z","2016-01-31T20:45:05.108Z","2015-09-30T21:54:06.382Z","2015-09-17T00:26:34.887Z","2015-09-21T14:40:27.082Z","2015-10-27T18:15:24.730Z","2015-12-24T12:11:13.372Z","2015-12-17T03:20:32.656Z","2015-12-02T07:57:12.565Z","2015-08-31T16:50:43.370Z","2015-12-21T18:30:42.627Z","2015-11-28T15:37:21.941Z","2015-11-03T00:07:23.470Z","2015-10-13T20:43:12.302Z","2015-11-21T20:36:01.349Z","2016-01-27T19:20:45.085Z","2015-12-03T10:59:57.394Z","2016-02-08T21:55:28.910Z","2015-11-13T08:27:35.625Z","2016-01-29T09:02:06.535Z","2016-01-23T16:16:19.312Z","2015-09-04T20:45:21.232Z","2015-12-18T20:48:42.449Z","2015-12-17T15:53:29.109Z","2016-02-06T07:34:55.789Z","2015-10-07T16:52:59.310Z","2015-10-28T21:05:54.532Z","2015-12-30T02:53:54.911Z","2016-02-20T01:02:14.605Z","2015-11-01T18:27:45.376Z","2015-11-22T20:12:49.507Z","2015-11-08T16:05:23.711Z","2016-01-09T10:45:13.042Z","2015-12-05T23:57:41.419Z","2015-11-18T23:33:18.883Z","2015-12-27T22:17:12.500Z","2015-11-07T19:27:55.190Z","2015-12-23T21:03:16.195Z","2015-11-18T22:46:04.841Z","2015-11-08T14:19:36.546Z","2015-11-04T16:38:43.275Z","2015-11-06T11:50:42.808Z","2015-12-30T03:54:00.145Z","2015-09-24T09:59:33.810Z","2015-10-18T15:42:21.640Z","2015-11-06T07:43:04.701Z","2015-11-20T10:04:57.337Z","2016-01-17T16:51:03.855Z","2015-10-26T15:32:08.128Z","2015-09-22T12:31:00.204Z","2015-11-25T06:18:19.213Z","2016-02-20T17:57:22.687Z","2016-02-20T20:29:24.393Z","2015-12-08T17:10:35.108Z","2015-12-22T23:34:41.650Z","2016-01-22T15:30:21.349Z","2015-12-28T11:44:08.530Z","2015-11-29T06:56:41.561Z","2015-10-23T06:23:26.250Z","2015-11-20T02:40:47.875Z","2016-02-04T02:48:40.250Z","2015-08-25T20:30:22.078Z","2016-02-08T19:24:42.904Z","2016-02-10T17:26:50.565Z","2015-10-02T23:14:42.461Z","2015-09-06T02:32:32.574Z","2015-09-09T13:18:41.122Z","2015-11-27T00:02:32.252Z","2015-09-29T06:34:54.860Z","2015-08-29T06:25:14.185Z","2016-01-17T15:41:34.848Z","2015-11-24T17:25:08.507Z","2015-10-03T16:36:08.418Z","2015-11-24T18:38:57.808Z"]},{"name":"Incididunt","dates":["2015-10-13T13:52:41.856Z","2016-02-10T08:45:45.889Z","2016-01-22T12:24:04.966Z","2016-01-05T00:33:54.295Z","2015-10-08T09:23:30.494Z","2015-10-11T03:56:10.471Z","2015-09-15T08:42:20.531Z","2015-10-19T12:50:12.776Z","2015-12-11T11:03:48.726Z","2015-12-22T00:49:42.120Z","2016-02-01T12:14:03.719Z","2016-01-21T13:36:35.426Z","2015-12-11T17:52:55.092Z","2015-09-13T08:44:24.748Z","2015-09-15T06:44:00.303Z","2015-09-08T15:22:38.400Z","2016-02-19T10:55:17.966Z","2015-11-18T02:49:24.650Z","2015-09-26T19:16:03.915Z","2015-10-26T22:00:13.774Z","2015-09-21T15:32:22.133Z","2016-02-13T07:38:55.839Z","2016-01-18T16:23:56.685Z","2015-12-15T13:49:33.009Z","2016-01-25T23:59:48.593Z","2015-12-17T15:05:18.508Z","2015-12-05T23:39:50.940Z","2015-10-07T01:11:24.725Z","2016-01-26T03:26:28.646Z","2015-08-26T12:52:56.958Z","2015-10-15T06:39:09.217Z","2015-09-13T11:05:02.636Z","2016-02-03T00:45:26.539Z","2015-10-11T16:30:24.452Z","2015-12-05T16:38:44.064Z","2016-02-10T05:31:41.144Z","2015-10-24T00:52:26.074Z","2015-12-16T00:34:03.208Z","2015-12-23T15:14:03.114Z","2015-09-27T20:44:22.247Z","2015-12-23T03:01:06.919Z","2015-09-30T21:56:59.570Z","2015-10-25T14:33:28.140Z","2016-02-02T03:09:42.459Z","2015-09-16T15:01:12.900Z","2016-01-21T08:24:54.277Z","2016-02-09T04:23:20.379Z","2015-11-07T11:15:21.454Z","2015-11-08T01:09:19.973Z","2015-11-09T17:46:37.556Z","2016-02-15T03:19:37.949Z","2015-09-15T13:53:09.382Z","2016-02-07T21:44:15.452Z","2015-11-22T06:01:34.409Z","2015-10-02T12:58:45.131Z","2015-10-05T20:24:01.142Z","2015-12-29T17:48:34.825Z","2015-09-05T04:58:14.398Z","2016-02-07T17:39:42.222Z","2015-11-21T11:36:37.448Z","2015-10-27T14:23:51.043Z","2015-12-05T17:07:04.115Z","2016-02-07T10:39:42.203Z","2015-10-11T07:19:35.382Z","2015-10-12T03:01:06.975Z","2015-11-13T15:51:01.052Z","2015-12-30T21:35:08.324Z","2016-02-17T08:41:59.603Z","2016-01-28T14:39:09.508Z","2015-09-17T04:44:38.848Z"]}]')



  var margin = {top: 20, right: 50, bottom: 30, left: 50},

      width = parseInt(d3.select('#field').style('width'),10) - margin.left - margin.right;
      var fieldRatio = 53.3/120;
      height = parseInt(fieldRatio*width);

      $('.heatmapContainer')
        .width(width)
        .height(height)
        .css({ top:margin.top,left:margin.left })


  var divHeight = d3.select('#field').style('height', height + margin.top + margin.bottom);


  var xScale = d3.scale.linear()
      .domain([0, 120 ])
      .range([0, width]);

  var yScale = d3.scale.linear()
      .domain([0, 53.3 ])
      .range([height, 0]);





      var homeFrames,awayFrames;
      if(heatmapData[0].key === "DEFENSE"){
        homeFrames = buildHeatmapFrames( heatmapData[1].values);
        awayFrames = buildHeatmapFrames( heatmapData[0].values);

      } else {
        homeFrames = buildHeatmapFrames( heatmapData[0].values);
        awayFrames = buildHeatmapFrames( heatmapData[1].values);
      }

  function buildHeatmapFrames(timeBins){
      // var newTimeBins = _.sortBy(timeBins,'millisecs_since_epoch');


    return timeBins.map(function(timeBin){
        var players = timeBin.values;
        return players.reduce(function( frame, player){
          var heatFootprint = [
              {
                x: Math.round(xScale(player.circle1_x),0),
                y: Math.round(yScale(player.circle1_y),0),
                radius: Math.round(xScale(player.circle1_r),0),
                value: Math.round(xScale(player.circle1_r),0)
              },
              {
                x: Math.round(xScale(player.circle2_x),0),
                y: Math.round(yScale(player.circle2_y),0),
                radius: Math.round(xScale(player.circle2_r),0),
                value: Math.round(xScale(player.circle2_r),0)
              }
          ];
          return frame.concat(heatFootprint);
        },[])
    })
  }

  var xAxisBottom = d3.svg.axis()
      .scale(xScale)
      .orient("bottom")
      .innerTickSize(-height)
      .outerTickSize(0)
      .tickPadding(10)
      .tickFormat(function(d) {
              if(d=== 0 || d== 120) return '';
              d = d-10
              if(d <50){
                return d;
              } else {

                return 100 - d
              }

              return d; });;

  var xAxisTop = d3.svg.axis()
          .scale(xScale)
          .orient("top")
          .innerTickSize(-height)
          .outerTickSize(0)
          .tickFormat(function(d) {
            if(d=== 0 || d==120) return '';
            d = d-10
            if(d <50){
              return d;
            } else {

              return 100 - d
            }

            return d; })
          .tickPadding(10);

  var yAxis = d3.svg.axis()
      .scale(yScale)
      .orient("left")
      .innerTickSize(-width)
      .outerTickSize(0)
      .tickPadding(10)


  var line = d3.svg.line()
      .x(function(d) { return xScale(d.x); })
      .y(function(d) { return yScale(d.y); });

  var svg = d3.select("body")
    .append("svg")
      .attr("class","field")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxisBottom)

    svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + 0 + ")")
            .call(xAxisTop)


    var playersData = data;
    var maxTime = 0;

    var players = playersData.map(function(playerDat){
      var player = _.clone(playerDat.values[0].values[0]);
      _.extend(player,playerDat);
    //  var values = _.sortBy(playerDat.values,'millisecs_since_epoch');
      var playerMarker = svg.append("circle");


      var color = player.team == "OFFENSE" ? 'rgba(0,255,0,.5)' : 'rgba(255,0,0,.5)';
      playerMarker.attr("r", xScale(0.5))
        .style("fill",color)
        .attr("transform", "translate(" + xScale(data[0].values[0].values[0].x) + ","+ yScale(data[0].values[0].values[0].y)  +")" );


      // var path = svg.append("path")
      //     .data([values])
      //     .attr("class", "line")
      //     .attr("d", line);

      player.marker = playerMarker;
      //player.path = path;

      return player;
    });

    maxTime = maxTime * 100;

    // var dataset = _(data[0].values[0].values[0].values)
    //                         .sortBy('millisecs_since_epoch')
    //                         .value();
    // var marker = svg.append("circle");
    //     marker.attr("r", xScale(1))
    //       .attr("transform", "translate(" + xScale(dataset[0].x) + ","+ yScale(dataset[0].y)  +")" );
    //
    //
    // var path = svg.append("path")
    //     .data([dataset])
    //     .attr("class", "line")
    //     .attr("d", line);
    //
    // players.forEach(function(player){
    //   transition(player);
    // })
initHeatmaps( width, height, homeFrames, awayFrames, players);
    function translateAlong(path) {
      var l = path.getTotalLength();
      return function(i) {
        return function(t) {
          var p = path.getPointAtLength(t * l);
          return "translate(" + p.x + "," + p.y + ")";//Move marker
        }
      }
    }

    function transition(player){
      player.marker.transition()
        .duration(maxTime)
        .attrTween("transform", translateAlong(player.path.node()))
    }

    function initHeatmaps(width, height, homeFrames, awayFrames, players ){

      // minimal heatmap instance configuration
      var heatmapInstance1 = h337.create({
        // only container is required, the rest will be defaults
        container: document.querySelector('.heatmap1'),
        gradient: {
            // enter n keys between 0 and 1 here
            // for gradient color customization
            '1': 'red',
            '0':'red'
            // '.8': 'red',
            // '.95': 'white'
          },
          //radius: 40,
          blur: 1,
          // the maximum opacity (the value with the highest intensity will have it)
          maxOpacity: .8,
          // minimum opacity. any value > 0 will produce
          // no transparent gradient transition
          minOpacity: .3

      });

      var heatmapInstance2 = h337.create({
        // only container is required, the rest will be defaults
        container: document.querySelector('.heatmap2'),
        gradient: {
            // enter n keys between 0 and 1 here
            // for gradient color customization
            '1': 'green',
            '0': 'green',
            // '.8': 'red',
            // '.95': 'white'
          },
          //radius: 40,
          blur: 1,
          // the maximum opacity (the value with the highest intensity will have it)
          maxOpacity: .8,
          // minimum opacity. any value > 0 will produce
          // no transparent gradient transition
          minOpacity: .3

      });


      function createData(){
        // now generate some random data
        var points = [];
        var max = 100;
        //var width = width;
        //var height = height;
        var len = 200;

        while (len--) {
          var val = Math.floor(Math.random()*100);
          max = Math.max(max, val);
          var point = {
            x: Math.floor(Math.random()*width),
            y: Math.floor(Math.random()*height),
            value: val
          };
          points.push(point);
        }
        // heatmap data format
        var data = {
        //  max: max,
          data: points
        };
        return data;
      }


      var max = homeFrames.length > awayFrames.length ? homeFrames.length : awayFrames.length;
      var currentFrame = 0;


      var startTime = new Date().getTime();
      var totalTime = max * 100;


      hash = {};

      setInterval(function(){

        var curTime = new Date().getTime();

        var diff = curTime - startTime;
        var refTime = diff % totalTime;
        currentFrame = Math.floor(refTime/100);

        players.map(function(player){
          var frmData = player.values[currentFrame].values[0];
          player.marker.transition()
            .duration(100)
            .attrTween("transform", function(){
              return function(){
                return "translate(" + xScale(frmData.x) + "," + yScale(frmData.y) + ")"
              }
            })
        })

        // player.marker.transition()
        //   .duration(maxTime)
        //   .attrTween("transform", translateAlong(player.path.node()))

        var offensiveData = {
          data: getFrame(homeFrames,currentFrame)
        };
        var defensiveData = {
          data: getFrame(awayFrames,currentFrame)
        };
        heatmapInstance2.setData(offensiveData);
        heatmapInstance1.setData(defensiveData);

        if(!_.has(hash,currentFrame)){
          console.log(currentFrame)

          hash[currentFrame]={
            frame: currentFrame,
            offensive:heatmapInstance2.getDataURL(),
            defensive:heatmapInstance1.getDataURL()
          };
          if(_.keys(hash).length == homeFrames.length){
            console.log(hash)
          }
        }


        // currentFrame++;
        //
        // if(currentFrame === max){
        //   currentFrame = 0;
        // }

      }, 100);

      function getFrame(data,idx){
        if(idx >= data.length){
          return [];
        }
        return data[idx];
      }


      // if you have a set of datapoints always use setData instead of addData
      // for data initialization

    }


}
function download(text, name, type) {
  var a = document.getElementById("save");
  var file = new Blob([text], {type: type});
  a.href = URL.createObjectURL(file);
  a.download = name;
}
$( "#save" ).click(function( event ) {

  download(JSON.stringify(_.values(hash)),'heatmapImages.json','text/plain')

    //this.href = 'data:plain/text,' + JSON.stringify(hash)
});
